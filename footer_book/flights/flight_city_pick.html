<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="../../css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="../../css/ui-box.css">
        <link rel="stylesheet" href="../../css/ui-base.css">
        <link rel="stylesheet" href="../../css/ui-color.css">
        <link rel="stylesheet" href="../../css/appcan.icon.css">
        <link rel="stylesheet" href="../../css/appcan.control.css">
    	<link rel="stylesheet" href="../../css/mui/mui.min.css">
    	<link rel="stylesheet" href="../../css/mui/mui.indexedlist.css">
        <link rel="stylesheet" type="text/css" href="../../css/main.css"/>
        <link rel="stylesheet" href="flight_city_content/css/main.css">
	    <style>
	    	[v-cloak]{display: none !important;}
	        input{outline: none;}
	        .result{padding: .3rem; border-bottom: 1px solid;}
	        .hide{
	        	display: none !important;
        	}
        	.city-bg input{
        		background-color: #fff;
        		color: #000;
        	}
        	.mui-indexed-list-bar{
        		width: 35px;
        		background-color: rgba(255,255,255,0);
    		}
        	.tab-indexed{
        		background-color: #3a5a98;
        		margin: 0;
        	}
        	.min-w5{
        		min-width: 31.5%;
        		max-width: 0.00%;
        		text-align: center;
        		display: inline-block;
        		box-sizing: border-box;
        	}
        	body{
        		font-size: 16px;
        	}
	    </style>
        <script type="text/javascript" src="../../js/setSkin.js"></script>
    </head>
    <body class="um-vp " ontouchstart>
        <div id="cityarea" class="up ub ub-ver user-white-bg mui-indexed-list" style="box-sizing: border-box;" tabindex="0">
            <!--header开始-->
            <div class="new_uinn tab-indexed" id="nav"></div>
            <!--header结束-->
            <!--content开始-->
            <div id="content" class="ub-f1 tx-l ub ub-ver" v-cloak>
            	<div id="content-0" class="ub-con ub ub-ver">
            		<div class="tab-head">
			            <div class="uh bc-text-head ub header-bg">
			                <div class="nav-btn">
			                    <div class="ub-img user-icon-goback umw1-5 umh4"></div>
			                </div>
			                <div class="ut ub-f1 ulev-3 ut-s tx-c">
			                    <div class="city-bg uinput ub ub-f1 uba uc-a1 ub-ac" style="background-color: #ffffff; display: none !important;">
			                        <div class="uinn fa fa-search sc-text padding0"></div>
			                        <input autocomplete="autocomplete" style="background-color: transparent" placeholder="北京/beijing/bj/bjs/中国" type="text" class="ub-f1 search">
			                    </div>
								<div class="mui-indexed-list-search mui-input-row mui-search city-bg" id="search-header">
									<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="北京/beijing">
								</div>
			                </div>
			            </div>
		            </div>
	            	<div class="ub-f1">
						<div class="mui-indexed-list-bar">
							<a v-for="(key, val) in gn">{{val}}</a>
						</div>
						<div class="mui-indexed-list-alert"></div>
						<div class="mui-indexed-list-inner">
							<div class="mui-indexed-list-empty-alert">没有数据</div>
							<ul class="mui-table-view">
					            <div class="uinn ubb bc-border mui-indexed-history" id="history-gn">
					            	<div class="ulev-app2">当前/历史</div>
	            					<div class="">
	            						<div class="city uba bc-border ub-f1 uinn-d umar-2 min-w5 ulev-1" v-bind:data-city="curCityCode" style="color:red">{{curCity}}</div><!--
	            					 --><template v-for="(item, index) in gnHis">
	            							<div class="city uba bc-border ub-f1 uinn-d umar-2 min-w5 ulev-1" v-bind:data-city="gnHis[index].cityCode">{{gnHis[index].city}}</div>
	            						</template>
	            					</div>
					            </div>
					            <div class="uinn ubb bc-border mui-indexed-hot">
					                <div class="ulev-app2">热门</div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="PEK">北京</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="SHA">上海 </div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="SZX">深圳 </div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="CAN">广州</div>
					                </div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="CTU">成都</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="HGH">杭州</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="WUH">武汉</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="SIA">西安</div>
					                </div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="CKG">重庆</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="TAO">青岛</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="CSX">长沙</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="NKG">南京</div>
					                </div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="XMN">厦门</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="KMG">昆明</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="DLC">大连</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="TSN">天津</div>
					                </div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="TNA">济南</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="FOC">福州</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="SYX">三亚</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="CGO">郑州</div>
					                </div>
					            </div>
								<template v-for="(key, val) in gn">
									<li v-bind:data-group="val" class="mui-table-view-divider mui-indexed-list-group">{{val}}</li>
									<template v-for="(item, index) in key">
										<li v-bind:data-pinyinname="item.pinyinName" v-bind:data-city="item.dataCity" class="city mui-table-view-cell mui-indexed-list-item">{{item.display}} {{item.dataTags}}</li>
									</template>
								</template>
							</ul>
						</div>
			        </div>
			        <!--<div id="list"></div>-->
		        </div>
		        <div id="content-1" class="ub-con ub ub-ver hide">
		        	<div class="tab-head">
			            <div class="uh bc-text-head ub header-bg">
			                <div class="nav-btn">
			                    <div class="ub-img user-icon-goback umw1-5 umh4"></div>
			                </div>
			                <div class="ut ub-f1 ulev-3 ut-s tx-c">
			                    <div class="city-bg uinput ub ub-f1 uba uc-a1 ub-ac" style="background-color: #ffffff; display: none !important;">
			                        <div class="uinn fa fa-search sc-text padding0"></div>
			                        <input autocomplete="autocomplete" style="background-color: transparent" placeholder="北京/beijing/bj/bjs/中国" type="text" class="ub-f1 search">
			                    </div>
								<div class="mui-indexed-list-search mui-input-row mui-search city-bg" id="search-header">
									<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="香港/Hong Kong">
								</div>
			                </div>
			            </div>
		            </div>
	            	<div class="ub-f1">
						<div class="mui-indexed-list-bar">
							<a v-for="(key, val) in gj">{{val}}</a>
						</div>
						<div class="mui-indexed-list-alert"></div>
						<div class="mui-indexed-list-inner">
							<div class="mui-indexed-list-empty-alert">没有数据</div>
							<ul class="mui-table-view">
					            <div class="uinn ubb bc-border mui-indexed-history" id="history-gj">
					            	<div class="ulev-app2">当前/历史</div>
		            				<template v-for="(item, index) in gjHis" v-if="index%3===0">
		            					<div class="ub">
		            						<div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" v-bind:data-city="gjHis[index+0].cityCode" v-if="index+0<gjHis.length">{{gjHis[index+0].city}}</div>
		            						<div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" v-bind:data-city="gjHis[index+1].cityCode" v-if="index+1<gjHis.length">{{gjHis[index+1].city}}</div>
		            						<div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" v-bind:data-city="gjHis[index+2].cityCode" v-if="index+2<gjHis.length">{{gjHis[index+2].city}}</div>
		            					</div>
		            				</template>
					            </div>
					            <div class="uinn ubb bc-border mui-indexed-hot">
					                <div class="ulev-app2">热门</div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="HKG">香港</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="SEL">首尔</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="MFM">澳门</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="TYO">东京</div>
					                </div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="TPE">台北</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="BKK">曼谷</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="OSA">大阪</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="SGN">胡志明市</div>
					                </div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="MNL">马尼拉</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="NGO">名古屋</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="LON">伦敦</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="KUL">吉隆坡</div>
					                </div>
					                <div class="ub">
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="PUS">釜山</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="SYD">悉尼</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="FRA">法兰克福</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="YVR">温哥华</div>
					                </div>
					                <div class="ub">
					                	<div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="PAR">巴黎</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="NYC">纽约</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="LAX">洛杉矶</div>
					                    <div class="city uba bc-border ub-f1 uinn-d umar-2 ub ub-ac ub-pc min-w5 ulev-1" data-city="HNL">夏威夷·火奴鲁鲁</div>
					                </div>
					            </div>
								<template v-for="(key, val) in gj">
									<li v-bind:data-group="val" class="mui-table-view-divider mui-indexed-list-group">{{val}}</li>
									<template v-for="(item, index) in key">
										<li v-bind:data-pinyinname="item.pinyinName" v-bind:data-city="item.dataCity" class="city mui-table-view-cell mui-indexed-list-item">{{item.display}} {{item.dataTags}}</li>
									</template>
								</template>
							</ul>
						</div>
			        </div>
		        </div>
            </div>
            <!--content结束-->

        </div>
        
        <script src="../../js/appcan.js"></script>
        <script src="../../js/appcan.control.js"></script>
        <script src="../../js/appcan.tab.js"></script>
    	<script src="../../js/appcan.listview.js"></script>
    	<script src="../../js/vue.min.js"></script>
        <script src="../../js/common.js"></script>
        <script src="../../js/mui/mui.min.js"></script>
        <script src="../../js/mui/mui.indexedlist.js"></script>
    	<script src="js/guoneiCity.js"></script>
    	<script src="js/guojiCity.js"></script>
    	<!--<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=c9c9b2b402afe3efd3ee0134f3e2b77e"></script>-->
    	<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=c9c9b2b402afe3efd3ee0134f3e2b77e&plugin=AMap.CitySearch"></script>
    	<script>
		    var fromCity =false;
		    var ToCity = false;
		    var cityArr = [];
		    cityArr["type"] = "flight";
		    cityArr["data"] = arrData;
		    
		    window.onorientationchange = window.onresize = function() {
				window.location.reload();
			};
			
		    var vm = new Vue({
    			el: '#content',
    			data: {
    				gn: [],
    				gj: [],
    				gnHis: [],
    				gjHis: [],
    				curCity: '　',
    				curCityCode: ''
    			},
    			methods: {
    				
    			}
			});
		    
    		$(function(){
    			vm.gnHis.length?vm.gnHis.length:0;
    			vm.gjHis.length?vm.gjHis.length:0;
				
    			//tab切换
                var tabview = appcan.tab({
                    selector : "#nav",
                    hasIcon : false,
                    hasAnim : true,
                    hasLabel : true,
                    hasBadge : false,
                    data : [{
                        label : "国内",
                    }, {
                        label : "国际",
                    }]
                });
                tabview.on("click", function(obj, index){
                	$('#content-'+index).removeClass('hide').siblings().addClass('hide');
                    tabRadius(index);
                    initList(index);
                });
                
                var headHeight = $('.header-bg').height(),
                	tabHeight = $('#nav').height();
                $('#nav').css({
                	'position': 'absolute',
                	'z-index': '100',
                	'top': headHeight,
                	'left': 0,
                	'right': 0
                });
                
                //左上返回键
                appcan.button(".nav-btn", "btn-act", function() {
                    if(localGetItem("fromcity")=="true"){
                        localSetItem("fromcity","false");
                    }
                    if(localGetItem("tocity")=="true"){
                        localSetItem("tocity","false");
                    }
                    window.history.back();
                });
                
                //处理城市数据
        		addMask('../../img/loading.gif', '加载中请稍后...');
        		for(var i in arrData){
        			var temp = arrData[i];
					for(var j in temp){
						var cityStr = temp[j].data.split('|');
						temp[j].pinyinName = cityStr[0];
						temp[j].dataCity = cityStr[3];
                		if(temp[j].dataCity.indexOf(",")>-1){
                    		temp[j].dataCity = temp[j].dataCity.split(",")[1];
                		}
					}
				}
        		console.log(arrData)
        		vm.gn = arrData;
        		
        		for(var p in intData){
        			var temp = intData[p];
					for(var q in temp){
						var cityStr = temp[q].data.split('|');
						temp[q].pinyinName = cityStr[0];
						temp[q].dataCity = cityStr[1].substring(cityStr[1].length - 4, cityStr[1].length - 1);
					}
				}
        		vm.gj = intData;
        		
        		//异步渲染
				Vue.nextTick(function(){
					mui.init();
					mui.ready(function() {
						initList(0);
						bindButton();
					});
				});
    			
				var citysearch = new AMap.CitySearch();
				citysearch.getLocalCity(function(status, result) {
		            if (status === 'complete' && result.info === 'OK') {
		                if (result && result.city) {
		                    var cityinfo = result.city;
		                    setCurrentCity(cityinfo);
		                }
		            } else {
		                console.log('获取当前城市有误：'+result.info);
		            }
		        });
			});
			
			//初始化列表
			function initList(i){
				var list = document.getElementById('content-'+i);
				window.indexedList = new mui.IndexedList(list);
				
                var headHeight = $(list).find('.header-bg').height(),
                	tabHeight = $('#nav').height();
                $('.tab-head').css({
                	'height': headHeight+tabHeight
                });
				
				//索引列表加载完毕后绑定事件
				if(i === 0){
					getHistoryCityNew('GN');
				}else{
					getHistoryCityNew('GJ');
				}
				
        		//异步渲染
				Vue.nextTick(function(){
					bindButton();
				});
			}
			
			//flag = 'GN'/'GJ'
			function getHistoryCityNew(flag){
				var historyCity = null;
				if(!localGetItem(cityArr["type"]+"historyCity"+flag)){
					localSetItem(cityArr["type"]+"historyCity"+flag, "[]");
					historyCity = localGetItem(cityArr["type"]+"historyCity"+flag);
				}else{
					historyCity = eval('('+localGetItem(cityArr["type"]+"historyCity"+flag)+')');
				}
				
				if(flag == 'GN'){
					vm.gnHis = historyCity;
				}else if(flag == 'GJ'){
					vm.gjHis = historyCity;
				}
			}
			
			function bindButton() {
				appcan.button(".city", "btn-act", function(){
					var city = $(this).text().trim();
	            	var cityNode = $(this).attr("data-city").trim();
	            	
	            	if($('#content-1').hasClass('hide')){
	            		flag = 'GN';
	            	}else{
	            		flag = 'GJ';
	            	}
	            	
	            	//获取历史查询城市
	            	var historyCity = eval(localGetItem(cityArr["type"]+"historyCity"+flag));
	            	
	            	//当前选中项写进缓存
	            	for(var i=0; i<historyCity.length; i++){
	            		if(city == historyCity[i].city){
	            			historyCity.splice(i, 1);
	            			break;
	            		}
	            	}
	            	
	            	if(city != localGetItem('currentCity')){
		            	var historyLen = historyCity.unshift({
		                    city: city,
		                    cityCode: cityNode
		            	});
		            	if(historyLen > 5){
		            		historyCity.pop();
		            	}
		            	
		            	localSetItem(cityArr["type"]+"historyCity"+flag, historyCity);
		            	
						Vue.nextTick(function(){
							getHistoryCityNew(flag);
						});
					}
	            	
	            	if(localGetItem("fromcity") == "true"){
	            		localSetItem("fromcity", "false");
						localSetItem("flightFromCity", city);
						localSetItem("flightFromCityNode", cityNode);
						window.history.replaceState(null, null, 'plane_ticket_search_content.html');
	                	location.reload();
					}
	            	if(localGetItem("tocity") == "true"){
	            		localSetItem("tocity", "false");
						localSetItem("flightToCity", city);
						localSetItem("flightToCityNode", cityNode);
						window.history.replaceState(null, null, 'plane_ticket_search_content.html');
	                	location.reload();
					}
				});
			}
			
			function setCurrentCity(str){
				var city = str,
					cityCode = '';
				
				if(!localGetItem('currentCityCode')){
					localSetItem('currentCityCode', '');
				}
				
                if (city.substring(city.length-1, city.length)=='市') {
                	city = city.substring(0, city.length-1);
                	localSetItem('currentCity', city);
                }
                
				if (cityArr['type'] == 'flight') {
					for (var i in cityArr['data']) {
						for (var j = 0; j < cityArr['data'][i].length; j++) {
							if (cityArr['data'][i][j].display == city) {
								cityCode = cityArr['data'][i][j].data.split('|')[3];
								break;
							}
						}
					}
					if (cityCode.split(',') > -1) {
						cityCode = cityCode.split(',')[1];
					}
					localSetItem('currentCityCode', cityCode);
				}
				
				vm.curCity = city;
				vm.curCityCode = cityCode;
				removeMask();
			}
		</script>
    </body>
</html>