<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

	<head>
		<title></title>
		<meta charset="utf-8">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" href="../../css/fonts/font-awesome.min.css">
		<link rel="stylesheet" href="../../css/ui-box.css">
		<link rel="stylesheet" href="../../css/ui-base.css">
		<link rel="stylesheet" href="../../css/ui-color.css">
		<link rel="stylesheet" href="../../css/appcan.icon.css">
		<link rel="stylesheet" href="../../css/appcan.control.css">
		<link rel="stylesheet" type="text/css" href="../../css/main.css" />
		<link rel="stylesheet" type="text/css" href="css/plane.css" />
		<style type="text/css">
			#header{
			    font-size: 1em;
			}
			#header, #dateList, .plane-t-head{
				position: initial;
			}
			.longlist{overflow-y: scroll;-webkit-overflow-scrolling : touch;}
			[v-cloak]{display: none !important;}
		</style>
        <script type="text/javascript" src="../../js/setSkin.js"></script>
	</head>
	<body class="um-vp sc-bg-active ub" ontouchstart>
		<div class="ub-con ub ub-ver" id="planeBookList" v-cloak>
		    <div id="header" class="uh ub header-bg plane-list-header plane-book-head">
	            <div class="nav-btn back" id="nav-left">
	                <div class="ub-img user-icon-goback umw1-5 umh4"></div>
	            </div>
	            <div class="ub ub-ver ub-f1 title">
	                <div class="ub ub-ac ub-pc ub-f1 ulev-3 ut-s tx-c">
	                    <div id="depPlane">北京</div>
	                    <div class="head-icon ub-img"></div>
	                    <div id="arrPlane">上海</div>
	                </div>
	                <p class="cur-day ub ub-pc" id="curDay"></p>
	            </div>
	            <div class="nav-btn nav-bt icon-act" id="nav-right">
	                <a class="ub-img user-icon-phone umw1-5 umh4 ub ub-ac" href="tel:02086132900"></a>
	            </div>
	        </div>
	        <div class="plane-t-head header-bg">
	            <div class="plane-t-info ub">
	                <div>
	                    <p class="big" id="fromTime">{{flight.myDepDate}}</p>
	                    <p id="fromName">{{flight.fromName}}</p>
	                </div>
	                <div class="ub ub-ac ub-ver">
	                    <div class="arrow ub-img" id="duration">{{parseInt(flight.duration/60)+ 'h' + parseInt(flight.duration % 60) + 'm'}}</div>
	                    <p id="stop" class="stop">{{flight.stopNum > 0 ? '经停' : ''}}</p>
	                </div>
	                <div>
	                    <p class="big" id="toTime">{{flight.myArrDate}}</p>
	                    <p id="toName">{{flight.toName}}</p>
	                </div>
	            </div>
	            <div class="plane-t-tails">
	                <img :src="flight.logo" class="logo-img" onerror="this.src='img/logo/logo.png'" id="logoImg" />
	                <span class="name" id="aircode">{{flight.companyName}} {{flight.carrier}}</span>
	                <span>|</span>
	                <span class="num" id="flightnum">{{flight.flightNo}}</span>
	                <span>|</span>
	                <span id="fool">{{flight.fool ? '有餐' : '无餐'}}</span>
	            </div>
	        </div>
		    <div class="ub-f1 longlist">
	            <ul class="plane-book-ul">
	                <li class="ub ub-ac" v-for='item in items'>
	                    <div class="ub-f1">
	                        <p class="pink">
	                            <span v-if="item.price==''">暂无价格</span>
	                            <span v-else>￥{{item.price}} <span class="small">{{flight.tax>0?'+ ￥'+flight.tax:''}} {{flight.yq>0?'+ ￥'+flight.yq:''}}</span></span>
	                        </p>
	                        <p class="cost" v-if="flight.tax > 0 || flight.yq>0">
	                            <span class="small">{{item.tax}} {{item.yq}}</span>
	                        </p>
	                        <p>
	                            <span>{{item.shipping}} {{item.myDiscount}}</span>
	                        </p>
	                    </div>
	                    <div v-if="item.price != ''">                       
	                        <div class="book" v-if="item.seatsRemain=='A'">
	                            <div class="b-btn ub ub-ac ub-pc" v-on:click="book(item)">预订</div>
	                        </div>
	                        <div class="book num" v-else v-on:click="book(item)">
	                            <div class="num-btn ub ub-ac ub-pc">预订</div>
	                            <div class="surplus ub ub-ac ub-pc">剩{{item.seatsRemain}}张</div>
	                        </div>
	                    </div>
	                </li>
	            </ul>
		    </div>
	    </div>
	</body>
	<script src="../../js/appcan.js"></script>
	<script src="../../js/appcan.control.js"></script>
	<script src="../../js/vue.min.js"></script>
	<script src="js/shipping.js"></script>
	<script src="../../js/common.js"></script>
	<script>
	    $(function(){
	        appcan.button("#nav-left", "btn-act", function() {
                window.history.back();
           });
            appcan.button("#nav-right", "btn-act", function() {
                //uexCall.dial("02086132900");
            });
            $("#depPlane").html(appcan.locStorage.getVal("flightFromCity"));
            $("#arrPlane").html(appcan.locStorage.getVal("flightToCity"));
            var getDay = appcan.locStorage.getVal("airDate");
            $("#curDay").text(NYR(getDay, 2) + ' ' + NYR(getDay, 3));
	    });
		var flightDetail = appcan.locStorage.getVal('flightDetail');
		flightDetail = eval('(' + flightDetail + ')');
		if(flightDetail) {
			var seats = flightDetail.seats;
			for(var i = 0; i < seats.length; i++) {
				if(myShipping[seats[i].code]) {
					seats[i].shipping = myShipping[seats[i].code];
				} else {
					seats[i].shipping = '其他舱位';
				}
				var discount = (seats[i].sale * 1 / 10).toFixed(1);
				if(discount > 0 && discount < 10) {
					seats[i].myDiscount = discount + '折';
				} else {
					seats[i].myDiscount = '';
				}
				seats[i].tax = flightDetail.tax > 0 ? '机场建设费：￥' + flightDetail.tax : '';
				seats[i].yq = flightDetail.yq > 0 ? '燃油费：￥' + flightDetail.yq : '';
			}

			var app = new Vue({
				el: '#planeBookList',
				data: {
					items: seats,
					flight:flightDetail
				},
				methods: {
					book: function(item) {
					    if(appcan.locStorage.getVal("applys")==="true"){
					        var beginDate = new Date(appcan.locStorage.getVal("begin")),
                            endDate = new Date(appcan.locStorage.getVal("end")),
                            airDate = new Date(appcan.locStorage.getVal("airDate")),
                            applyId = appcan.locStorage.getVal("itineraryId");
                            if(airDate.getTime()<beginDate.getTime() || airDate.getTime()>endDate.getTime()){
                                appcan.window.openToast("所选航班时间超出行程时间范围",2000);
                                return;
                            }
                            if(applyId == 0) {
                                appcan.window.openToast('请您先选择出差申请再预订', 2000);
                                return;
                            }
					    }
						appcan.locStorage.setVal('seatDetail', item);
						window.location.href = 'plane_ticket_bookdetails_content.html';
					}
				}
			});
        }
	</script>

</html>